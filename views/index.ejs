<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB Movies</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <%- include('partials/top-navbar') %>
    <% if (typeof success !== 'undefined' && success) { %>
      <div class="alert-success" id="success-alert">
        ¡Película añadida con éxito!
      </div>
      <script>
        setTimeout(function() {
          var alert = document.getElementById('success-alert');
          if(alert) alert.style.display = 'none';
        }, 3000);
      </script>
    <% } %>
    <%- include('partials/navbar') %>
    <div class="container">
        <h1>MongoDB Movies</h1>
        <button class="toggle-theme-btn" onclick="toggleTheme()">
          <span id="theme-label">Modo oscuro</span>
          <span class="toggle-switch">
            <span class="toggle-slider"></span>
          </span>
        </button>
        <div id="movies-list">
            <% movies.forEach(function(movie) { %>
                <div class="movie">
                    <h2><%= movie.title %></h2>
                    <% if (movie.poster) { %>
                        <a href="/movies/<%= movie._id %>">
                          <img src="<%= movie.poster %>" alt="<%= movie.title %> poster" style="max-width:200px;">
                        </a>
                    <% } %>
                    <p>Fecha de lanzamiento: <%= movie.released ? movie.released.toISOString().split('T')[0] : 'N/A' %></p>
                </div>
            <% }); %>
        </div>
    </div>
    <% if (typeof page !== 'undefined' && typeof totalPages !== 'undefined' && totalPages > 1) { %>
    <div class="pagination-bar floating-pagination">
        <nav aria-label="Paginación simple">
            <% function buildQuery(pageNum) {
                var params = [];
                if (typeof filters === 'object') {
                  for (var key in filters) {
                    if (Array.isArray(filters[key])) {
                      filters[key].forEach(function(val) { params.push(encodeURIComponent(key) + '=' + encodeURIComponent(val)); });
                    } else if (filters[key]) {
                      params.push(encodeURIComponent(key) + '=' + encodeURIComponent(filters[key]));
                    }
                  }
                }
                params.push('page=' + pageNum);
                return params.length ? '?' + params.join('&') : '';
            } %>
            <div class="pagination-controls">
                <% if (page > 1) { %>
                    <a href="/movies<%= buildQuery(page-1) %>" class="page-link" title="Anterior">&laquo;</a>
                <% } else { %>
                    <span class="page-link disabled">&laquo;</span>
                <% } %>
                <span class="page-link current">Página <%= page %> de <%= totalPages %></span>
                <% if (page < totalPages) { %>
                    <a href="/movies<%= buildQuery(page+1) %>" class="page-link" title="Siguiente">&raquo;</a>
                <% } else { %>
                    <span class="page-link disabled">&raquo;</span>
                <% } %>
            </div>
        </nav>
    </div>
    <% } %>
    <script>
      function toggleTheme() {
        const isDark = document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        document.getElementById('theme-label').textContent = isDark ? 'Modo claro' : 'Modo oscuro';
      }
      // Mantener preferencia al recargar
      if(localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
        document.getElementById('theme-label').textContent = 'Modo claro';
      }
    </script>
</body>
</html>
